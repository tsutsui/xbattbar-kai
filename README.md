# xbattbar ウインドウ表示版

xbattbar をタスクトレイにいい感じに表示したい、ということで
jwm のデフォルトの `system.jwmrc` が `xload` をタスクトレイに表示するのと同様に
アプリとしては通常ウインドウで表示して WMにトレイに入れさせればいいのでは、
と ChatGPT に聞きつつ修正してみたものです。

合わせてオリジナルの xbattbar のバグと思われる実装も修正してあります。
（インターバルの `setitimer(3)` のシグナルハンドラから Xlib を呼ぶのはNG）

## 使い方

```
% xbattbar [-h|v] [-g geometry] [-p sec] [-I color] [-O color] [-i color] [-o color] [-F font]
```

`~/.jwmrc` に以下のように記述することを想定しています。

```xml
        <Swallow name="xbattbar" height="16" width="64">
           xbattbar
        </Swallow>
```

## 修正内容

1. バーではなく通常のXアプリウインドウでバッテリ状態と充電量パーセンテージを表示
1. マウスオーバーでのバッテリ状態表示の削除
1. 複数スクリーン対応
1. 警告抑止の修正
1. シグナルハンドラから Xlib を呼ぶとおかしくなるので `select(2)` の待ちに変更
1. Linux用実装の未定義動作を修正（未テスト）

## その他

もはや `xbattbar` という名前とはあっていないというか、
NetBSDとしても `envstat(8)` で普通にバッテリ容量取れてるのだから、
時代遅れになっているAPM実装も消してイチから書き直したほうがいいような、
という気もしてます。